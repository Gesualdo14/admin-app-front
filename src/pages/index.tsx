import {
  Button,
  ButtonGroup,
  Card,
  Container,
  Heading,
  Spinner,
} from "@chakra-ui/react"
import { type NextPage } from "next"
import Head from "next/head"
import { env } from "~/env.mjs"
import { useRouter } from "next/router"
import axios from "axios"
import { useQuery } from "@tanstack/react-query"
import SalesList from "components/entities/sales/SalesList"

const Home: NextPage = () => {
  const { data: sales, isLoading } = useQuery({
    queryKey: ["sales"],
    queryFn: async () => {
      const res = await axios.get(`${env.NEXT_PUBLIC_BACKEND_BASE_URL}/sales`, {
        withCredentials: true,
      })
      return res.data.data
    },
  })

  const router = useRouter()
  return (
    <>
      <Head>
        <title>Admin APP</title>
        <meta name="description" content="Generated by create-t3-app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <Container marginTop={8}>
        <Button
          colorScheme="blue"
          mb={2}
          alignSelf="end"
          onClick={() => {
            router.push("/login")
          }}
        >
          Iniciar sesi√≥n
        </Button>
        <Card p={4}>
          <Heading>Mis ventas</Heading>
          {isLoading ? <Spinner /> : <SalesList sales={sales} />}
          <ButtonGroup mt={8}>
            <Button
              colorScheme="blue"
              onClick={() => {
                router.push("/sales/new")
              }}
            >
              Nueva venta
            </Button>
            <Button
              colorScheme="purple"
              onClick={() => {
                router.push("/clients")
              }}
            >
              Clientes
            </Button>
          </ButtonGroup>
        </Card>
      </Container>
    </>
  )
}

export default Home
